<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>3D Water Background (Profile)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #05080f;
      font-family: Arial, sans-serif;
    }
    #water-bg {
      position: fixed;
      inset: 0;
      z-index: -1;
    }
    #controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.45);
      padding: 12px 16px;
      border-radius: 12px;
      display: flex;
      gap: 12px;
      align-items: center;
      color: #fff;
    }
    #controls label {
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    #controls input[type="range"] {
      width: 120px;
    }
    #controls button {
      padding: 6px 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #2b7cff;
      color: #fff;
      font-weight: bold;
    }
  </style>
</head>
<body>

<canvas id="water-bg"></canvas>

<div id="controls">
  <label>
    ƒê·ªô cao s√≥ng
    <input id="waveHeight" type="range" min="0" max="3" step="0.1" value="1.2">
  </label>
  <label>
    Gi√≥
    <input id="waveSpeed" type="range" min="0" max="4" step="0.1" value="1.5">
  </label>
  <label>
    M√†u s√≥ng
    <input id="waveColor" type="color" value="#2b8cff">
  </label>
  <button id="pulseBtn">üåä T·∫°o s√≥ng</button>
</div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';

const canvas = document.getElementById('water-bg');
const scene = new THREE.Scene();
const camera = new THREE.OrthographicCamera(-10, 10, 10, -10, 0.1, 50);
camera.position.set(0, 15, 0);
camera.lookAt(0, 0, 0);

const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(devicePixelRatio);

const uniforms = {
  uTime: { value: 0 },
  uWaveHeight: { value: 1.2 },
  uWaveSpeed: { value: 1.5 },
  uPulseTime: { value: -10 },
  uPulseCenter: { value: new THREE.Vector2(0, 0) },
  uColor: { value: new THREE.Color('#2b8cff') }
};

const geometry = new THREE.PlaneGeometry(20, 20, 200, 200);
const material = new THREE.ShaderMaterial({
  uniforms,
  vertexShader: `
    uniform float uTime;
    uniform float uWaveHeight;
    uniform float uWaveSpeed;
    uniform float uPulseTime;
    uniform vec2 uPulseCenter;
    varying float vWave;
    void main() {
      vec3 pos = position;
      float wave = sin(pos.x * 1.2 + uTime * uWaveSpeed)
                 + cos(pos.y * 1.1 + uTime * uWaveSpeed);
      float dist = distance(pos.xz, uPulseCenter);
      float pulse = sin(dist * 2.0 - (uTime - uPulseTime) * 6.0)
                  * exp(-dist * 0.25)
                  * step(0.0, 2.5 - (uTime - uPulseTime));
      pos.y += wave * uWaveHeight + pulse * 3.0;
      vWave = pos.y;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
    }
  `,
  fragmentShader: `
    uniform vec3 uColor;
    varying float vWave;
    void main() {
      float shade = vWave * 0.15 + 0.5;
      gl_FragColor = vec4(uColor * shade, 1.0);
    }
  `,
  wireframe: false
});

const water = new THREE.Mesh(geometry, material);
scene.add(water);

function animate(t) {
  uniforms.uTime.value = t * 0.001;
  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

// Resize
window.addEventListener('resize', () => {
  renderer.setSize(innerWidth, innerHeight);
});

// UI controls
document.getElementById('waveHeight').oninput = e =>
  uniforms.uWaveHeight.value = +e.target.value;

document.getElementById('waveSpeed').oninput = e =>
  uniforms.uWaveSpeed.value = +e.target.value;

document.getElementById('waveColor').oninput = e =>
  uniforms.uColor.value.set(e.target.value);

function createPulse(x, y) {
  uniforms.uPulseCenter.value.set(x, y);
  uniforms.uPulseTime.value = uniforms.uTime.value;
}

// Button pulse
document.getElementById('pulseBtn').onclick = () => createPulse(0, 0);

// Click anywhere ‚Üí ripple
canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width) * 20 - 10;
  const y = ((rect.bottom - e.clientY) / rect.height) * 20 - 10;
  createPulse(x, y);
});
</script>

</body>
</html>
