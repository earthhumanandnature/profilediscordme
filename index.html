<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discord Profile + Water</title>

<link rel="icon" href="https://discord.com/assets/847541504914fd33810e70a0ea73177e.ico">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  font-family:system-ui;
  background:#020617;
}

/* ===== WATER ===== */
#water-bg{
  position:fixed;
  inset:0;
  display:none;
  z-index:-10;
}

#water-controls{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:none;
  gap:14px;
  padding:12px 16px;
  background:rgba(0,0,0,.5);
  border-radius:14px;
  color:#fff;
  z-index:10;
  font-size:12px;
}

#water-controls label{
  display:flex;
  flex-direction:column;
  gap:4px;
}
#water-controls input[type=range]{width:110px}

/* ===== UI ===== */
.container{
  position:relative;
  z-index:2;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.hidden{display:none}

.card{
  background:#0f172a;
  color:#fff;
  padding:24px;
  border-radius:16px;
}

.welcome{
  text-align:center;
  color:#fff;
}
.login-btn{
  display:inline-block;
  margin-top:16px;
  padding:10px 20px;
  background:#5865F2;
  color:#fff;
  border-radius:10px;
  text-decoration:none;
}
</style>
</head>

<body>

<canvas id="water-bg"></canvas>

<div id="water-controls">
  <label>S√≥ng
    <input id="waveHeight" type="range" min="0" max="3" step="0.1" value="1.5">
  </label>
  <label>Gi√≥
    <input id="waveSpeed" type="range" min="0" max="4" step="0.1" value="1.2">
  </label>
  <label>M√†u
    <input id="waveColor" type="color" value="#2b8cff">
  </label>
  <button id="pulseBtn">üåä T·∫°o s√≥ng</button>
</div>

<div class="container">
  <div id="welcome" class="welcome">
    <h2>Ch√†o m·ª´ng</h2>
    <p>ƒêƒÉng nh·∫≠p Discord ƒë·ªÉ xem profile</p>
    <a class="login-btn"
      href="?login=1">ƒêƒÉng nh·∫≠p (demo)</a>
  </div>

  <div id="profile-card" class="card hidden">
    <h2>Discord Profile</h2>
    <p>Login th√†nh c√¥ng üéâ</p>
  </div>
</div>

<!-- ================= THREE WATER ================= -->
<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";

const canvas = document.getElementById("water-bg");
const controlsUI = document.getElementById("water-controls");

let scene, camera, renderer, water, uniforms;
let started = false;
const SIZE = 200;
const pulses = [];

function startWater(){
  if(started) return;
  started = true;

  scene = new THREE.Scene();

  renderer = new THREE.WebGLRenderer({
    canvas,
    antialias:true,
    alpha:true
  });
  renderer.setSize(innerWidth,innerHeight);
  renderer.setPixelRatio(devicePixelRatio);

  camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 1000);
  camera.position.set(0, SIZE*0.9, 0);
  camera.up.set(0,0,-1);
  camera.lookAt(0,0,0);

  const geo = new THREE.PlaneGeometry(SIZE,SIZE,256,256);
  geo.rotateX(-Math.PI/2);

  uniforms = {
    uTime:{value:0},
    uWaveHeight:{value:1.5},
    uWaveSpeed:{value:1.2},
    uWaveFreq:{value:0.05},
    uPulseTime:{value:-10},
    uPulseStrength:{value:3},
    uPulseCenter:{value:new THREE.Vector2()}
  };

  const mat = new THREE.ShaderMaterial({
    uniforms,
    vertexShader:`
      uniform float uTime,uWaveHeight,uWaveSpeed,uWaveFreq;
      uniform float uPulseTime,uPulseStrength;
      uniform vec2 uPulseCenter;
      varying float vH;
      void main(){
        vec3 p=position;
        float base =
          sin(p.x*uWaveFreq+uTime*uWaveSpeed)+
          cos(p.z*uWaveFreq+uTime*uWaveSpeed);
        float d=distance(p.xz,uPulseCenter);
        float pulse =
          sin(d*1.5-(uTime-uPulseTime)*8.0)
          *exp(-d*0.08)*uPulseStrength;
        p.y+=base*uWaveHeight+pulse;
        vH=p.y;
        gl_Position=projectionMatrix*modelViewMatrix*vec4(p,1.);
      }
    `,
    fragmentShader:`
      varying float vH;
      void main(){
        vec3 deep=vec3(0.0,0.15,0.3);
        vec3 light=vec3(0.3,0.6,1.0);
        float h=clamp((vH+3.)/6.,0.,1.);
        gl_FragColor=vec4(mix(deep,light,h),1.);
      }
    `,
    side:THREE.DoubleSide
  });

  water = new THREE.Mesh(geo,mat);
  scene.add(water);

  canvas.addEventListener("click",e=>{
    const r=canvas.getBoundingClientRect();
    const x=((e.clientX-r.left)/r.width)*2-1;
    const y=-((e.clientY-r.top)/r.height)*2+1;
    const ray=new THREE.Raycaster();
    ray.setFromCamera({x,y},camera);
    const hit=ray.intersectObject(water);
    if(hit[0]){
      pulses.push({
        x:hit[0].point.x,
        z:hit[0].point.z,
        start:uniforms.uTime.value,
        life:2+Math.random()
      });
    }
  });

  setInterval(()=>{
    for(let i=0;i<2;i++){
      pulses.push({
        x:(Math.random()-.5)*SIZE,
        z:(Math.random()-.5)*SIZE,
        start:uniforms.uTime.value,
        life:2+Math.random()
      });
    }
  },1000);

  document.getElementById("waveHeight").oninput=e=>{
    uniforms.uWaveHeight.value=e.target.value;
  };
  document.getElementById("waveSpeed").oninput=e=>{
    uniforms.uWaveSpeed.value=e.target.value;
  };
  document.getElementById("waveColor").oninput=e=>{
    mat.fragmentShader = mat.fragmentShader;
  };
  document.getElementById("pulseBtn").onclick=()=>{
    pulses.push({
      x:0,z:0,start:uniforms.uTime.value,life:3
    });
  };

  function animate(t){
    requestAnimationFrame(animate);
    uniforms.uTime.value=t*0.001;

    const now=uniforms.uTime.value;
    for(let i=pulses.length-1;i>=0;i--){
      if(now-pulses[i].start>pulses[i].life){
        pulses.splice(i,1);
      }
    }
    if(pulses[0]){
      uniforms.uPulseCenter.value.set(pulses[0].x,pulses[0].z);
      uniforms.uPulseTime.value=pulses[0].start;
    }else{
      uniforms.uPulseTime.value=-100;
    }

    renderer.render(scene,camera);
  }
  animate(0);
}

/* ===== LOGIN SIMULATION ===== */
if(location.search.includes("login")){
  document.getElementById("welcome").classList.add("hidden");
  const card=document.getElementById("profile-card");
  card.classList.remove("hidden");

  canvas.style.display="block";
  controlsUI.style.display="flex";
  startWater();
}
</script>

</body>
</html>
